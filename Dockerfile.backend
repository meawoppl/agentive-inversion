# Simple runtime image - just copies pre-built binary
FROM debian:bookworm-slim

RUN apt-get update && \
    apt-get install -y libpq5 postgresql-client ca-certificates && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy pre-built binary from host
COPY ./target/release/backend /app/backend

# Copy migrations and seed data
COPY migrations ./migrations
COPY diesel.toml ./
COPY seed-data.sql ./

# Copy startup script
COPY docker-entrypoint-backend.sh /app/
RUN chmod +x /app/docker-entrypoint-backend.sh

EXPOSE 3000

ENTRYPOINT ["/app/docker-entrypoint-backend.sh"]
