name: Deploy

on:
  push:
    branches: [ main ]

# Deployment notes:
# - The container image includes diesel_cli for migrations
# - Migrations run automatically on container startup via entrypoint
# - Migrations are tracked in __diesel_schema_migrations table
# - For manual migration: docker exec <container> diesel migration run
#
# Required environment variables for the container:
#   DATABASE_URL          - PostgreSQL connection string
#   JWT_SECRET            - Secret for signing auth cookies (openssl rand -hex 32)
#   ALLOWED_EMAILS        - Comma-separated list of authorized user emails
#   GOOGLE_CLIENT_ID      - Google OAuth client ID
#   GOOGLE_CLIENT_SECRET  - Google OAuth client secret
#   AUTH_REDIRECT_URI     - OAuth callback for user login
#   OAUTH_REDIRECT_URI    - OAuth callback for Gmail API

jobs:
  deploy:
    name: Deploy Application
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4

      - name: Deploy placeholder
        run: |
          echo "Deployment steps:"
          echo "1. Container is built by container.yml workflow"
          echo "2. Push container to registry"
          echo "3. Deploy to target environment"
          echo "4. Migrations run automatically on startup"
          echo ""
          echo "Implement actual deployment for your infrastructure here"
